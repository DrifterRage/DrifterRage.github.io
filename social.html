<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TwoRoadsDayZ — Wasteland Network</title>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0a0000 0%, #1a0000 25%, #2b0000 50%, #1a0000 75%, #0a0000 100%);
      color: #e0e0e0; overflow-x: hidden; position: relative; min-height: 100vh;
    }
    body::before {
      content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background:
        radial-gradient(circle at 20% 80%, rgba(220, 20, 20, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(139, 0, 0, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(205, 92, 92, 0.05) 0%, transparent 50%);
      z-index: -2; pointer-events: none;
    }

    /* Navigation */
    nav {
      position: fixed; top: 0; width: 100%; background: rgba(10,0,0,0.95);
      backdrop-filter: blur(20px); padding: 1rem 0; z-index: 1000;
      border-bottom: 3px solid rgba(220, 20, 20, 0.5); transition: all .3s ease;
      box-shadow: 0 2px 20px rgba(139,0,0,.3);
    }
    .nav-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 2rem; }
    .logo {
      font-size: 1.8rem; font-weight: bold; background: linear-gradient(45deg, #dc1414, #ff6b6b, #b30000);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-decoration: none;
    }
    .nav-links { display: flex; list-style: none; gap: 2rem; align-items: center; }
    .nav-links a { color: #e0e0e0; text-decoration: none; font-weight: 600; transition: color .3s ease; }
    .nav-links a:hover { color: #dc1414; }

    /* Main Layout */
    .main-container { display: grid; grid-template-columns: 300px 1fr 300px; gap: 2rem; max-width: 1400px; margin: 80px auto 0; padding: 2rem; }
    
    /* Sidebar Styles */
    .sidebar { background: rgba(26,0,0,0.8); backdrop-filter: blur(20px); border-radius: 20px; padding: 2rem; border: 2px solid rgba(220,20,20,.3); height: fit-content; position: sticky; top: 100px; }
    .sidebar h3 { color: #dc1414; margin-bottom: 1rem; font-size: 1.2rem; }

    /* User Profile Card */
    .user-profile { text-align: center; margin-bottom: 2rem; }
    .profile-avatar { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(45deg, #dc1414, #b30000); display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 2rem; color: white; border: 3px solid rgba(220,20,20,.5); }
    .profile-stats { display: flex; justify-content: space-around; margin-top: 1rem; }
    .stat { text-align: center; }
    .stat-number { font-size: 1.2rem; font-weight: bold; color: #dc1414; }
    .stat-label { font-size: 0.8rem; color: #cd5c5c; }

    /* Feed Container */
    .feed-container { max-width: 600px; }
    
    /* Post Composer */
    .post-composer { background: rgba(26,0,0,0.8); backdrop-filter: blur(20px); border-radius: 20px; padding: 2rem; border: 2px solid rgba(220,20,20,.3); margin-bottom: 2rem; }
    .composer-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
    .composer-avatar { width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(45deg, #dc1414, #b30000); display: flex; align-items: center; justify-content: center; color: white; }
    .composer-input { flex: 1; }
    .composer-textarea { width: 100%; background: rgba(10,0,0,0.6); border: 2px solid rgba(220,20,20,.4); border-radius: 10px; padding: 1rem; color: #e0e0e0; resize: vertical; min-height: 100px; font-family: inherit; }
    .composer-textarea:focus { outline: none; border-color: #dc1414; box-shadow: 0 0 20px rgba(220,20,20,.4); }
    .composer-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; }
    .media-upload { display: flex; gap: 1rem; }
    .upload-btn { background: rgba(220,20,20,0.2); border: 2px solid rgba(220,20,20,.4); border-radius: 10px; padding: 0.5rem 1rem; cursor: pointer; transition: all .3s ease; color: #e0e0e0; }
    .upload-btn:hover { background: rgba(220,20,20,0.4); border-color: #dc1414; }
    .post-btn { background: linear-gradient(45deg,#dc1414,#b30000); color: white; border: none; padding: 0.8rem 2rem; border-radius: 25px; font-weight: 600; cursor: pointer; transition: all .3s ease; }
    .post-btn:hover { background: linear-gradient(45deg,#b30000,#8b0000); transform: translateY(-2px); }

    /* Post Styles */
    .post { background: rgba(26,0,0,0.8); backdrop-filter: blur(20px); border-radius: 20px; padding: 2rem; border: 2px solid rgba(220,20,20,.3); margin-bottom: 2rem; transition: all .3s ease; }
    .post:hover { border-color: rgba(220,20,20,.6); box-shadow: 0 10px 30px rgba(220,20,20,.2); }
    .post-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; }
    .post-user { display: flex; align-items: center; gap: 1rem; }
    .post-avatar { width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(45deg, #dc1414, #b30000); display: flex; align-items: center; justify-content: center; color: white; }
    .post-info h4 { color: #e0e0e0; margin-bottom: 0.2rem; }
    .post-time { color: #cd5c5c; font-size: 0.9rem; }
    .follow-btn { background: transparent; border: 2px solid #dc1414; color: #dc1414; padding: 0.3rem 1rem; border-radius: 15px; cursor: pointer; transition: all .3s ease; font-size: 0.8rem; }
    .follow-btn:hover, .follow-btn.following { background: #dc1414; color: white; }
    .post-content { margin: 1rem 0; line-height: 1.6; }
    .post-media { margin: 1rem 0; border-radius: 15px; overflow: hidden; }
    .post-image { width: 100%; max-height: 400px; object-fit: cover; border-radius: 15px; }
    .post-video { width: 100%; max-height: 400px; border-radius: 15px; }
    .post-actions { display: flex; gap: 1rem; padding-top: 1rem; border-top: 1px solid rgba(220,20,20,.2); }
    .action-btn { background: transparent; border: none; color: #cd5c5c; cursor: pointer; transition: color .3s ease; display: flex; align-items: center; gap: 0.5rem; }
    .action-btn:hover, .action-btn.active { color: #dc1414; }

    /* Comments Section */
    .comments-section {
      margin-top: 1rem;
      border-top: 1px solid rgba(220,20,20,.2);
      padding-top: 1rem;
      display: none;
    }
    .comments-section.show {
      display: block;
    }
    .comment-form {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .comment-input {
      flex: 1;
      background: rgba(10,0,0,0.6);
      border: 1px solid rgba(220,20,20,.4);
      border-radius: 5px;
      padding: 0.5rem;
      color: #e0e0e0;
      font-size: 0.9rem;
    }
    .comment-input:focus {
      outline: none;
      border-color: #dc1414;
    }
    .comment-btn {
      background: #dc1414;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .comment-btn:hover {
      background: #b30000;
    }
    .comment {
      background: rgba(26,0,0,0.4);
      padding: 0.75rem;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      border-left: 3px solid #dc1414;
    }
    .comment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.25rem;
    }
    .comment-author {
      font-weight: bold;
      color: #ff6b6b;
      font-size: 0.9rem;
    }
    .comment-time {
      color: #cd5c5c;
      font-size: 0.8rem;
    }
    .comment-text {
      color: #e0e0e0;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    /* Share Modal */
    .share-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 10000;
      display: none;
      justify-content: center;
      align-items: center;
    }
    .share-modal.show {
      display: flex;
    }
    .share-content {
      background: rgba(26,0,0,0.95);
      padding: 2rem;
      border-radius: 15px;
      border: 2px solid #dc1414;
      max-width: 400px;
      width: 90%;
    }
    .share-options {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1rem;
    }
    .share-btn {
      display: flex;
      align-items: center;
      gap: 1rem;
      background: rgba(220,20,20,0.2);
      border: 2px solid rgba(220,20,20,.4);
      border-radius: 10px;
      padding: 1rem;
      cursor: pointer;
      transition: all .3s ease;
      color: #e0e0e0;
      text-decoration: none;
    }
    .share-btn:hover {
      background: rgba(220,20,20,0.4);
      border-color: #dc1414;
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 80px;
      right: 20px;
      background: #dc1414;
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(220,20,20,0.3);
      z-index: 10001;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }
    .notification.show {
      transform: translateX(0);
    }

    /* Trending Section */
    .trending-item { padding: 1rem 0; border-bottom: 1px solid rgba(220,20,20,.2); }
    .trending-item:last-child { border-bottom: none; }
    .trending-tag { color: #dc1414; font-weight: bold; }
    .trending-count { color: #cd5c5c; font-size: 0.9rem; }

    /* Suggestions */
    .suggestion-item { display: flex; align-items: center; gap: 1rem; padding: 1rem 0; border-bottom: 1px solid rgba(220,20,20,.2); }
    .suggestion-item:last-child { border-bottom: none; }
    .suggestion-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(45deg, #dc1414, #b30000); display: flex; align-items: center; justify-content: center; color: white; }
    .suggestion-info { flex: 1; }
    .suggestion-name { color: #e0e0e0; font-weight: 600; }
    .suggestion-handle { color: #cd5c5c; font-size: 0.9rem; }
    .suggestion-follow { background: #dc1414; color: white; border: none; padding: 0.3rem 1rem; border-radius: 15px; cursor: pointer; font-size: 0.8rem; }

    /* Responsive */
    @media (max-width: 1200px) {
      .main-container { grid-template-columns: 1fr; gap: 1rem; }
      .sidebar { position: static; }
    }

    @media (max-width: 768px) {
      .nav-container { flex-direction: column; gap: 1rem; }
      .main-container { padding: 1rem; }
      .composer-actions { flex-direction: column; gap: 1rem; align-items: stretch; }
      .media-upload { justify-content: center; }
    }

    /* Animations */
    .fade-in { opacity: 0; transform: translateY(20px); animation: fadeIn 0.6s ease forwards; }
    @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }

    /* Hide file inputs */
    .file-input { display: none; }

    /* Media preview */
    .media-preview { margin-top: 1rem; }
    .preview-image { max-width: 100%; max-height: 200px; border-radius: 10px; }
    .remove-media { background: #dc1414; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; position: absolute; top: 5px; right: 5px; }
    .media-preview-container { position: relative; display: inline-block; }
  </style>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TPFMB30C0P"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-TPFMB30C0P');
  </script>
</head>
<body>
  <!-- Navigation -->
  <nav id="navbar">
    <div class="nav-container">
      <a href="index.html" class="logo">TwoRoadsDayZ</a>
      <ul class="nav-links">
        <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
        <li><a href="join.html"><i class="fas fa-server"></i> Join</a></li>
        <li><a href="store.html"><i class="fas fa-shopping-cart"></i> Store</a></li>
        <li><a href="about.html"><i class="fas fa-info"></i> About</a></li>
        <li><a href="contact.html"><i class="fas fa-envelope"></i> Contact</a></li>
        <li><a href="social.html"><i class="fas fa-users"></i> Community</a></li>
        <li><a href="media.html"><i class="fas fa-play"></i> Media</a></li>
      </ul>
    </div>
  </nav>

  <!-- Share Modal -->
  <div class="share-modal" id="shareModal">
    <div class="share-content">
      <h3 style="color: #dc1414; margin-bottom: 1rem;">
        <i class="fas fa-share"></i> Share This Post
      </h3>
      <p style="color: #cd5c5c; margin-bottom: 1rem; font-size: 0.9rem;">Choose where to share this survival story:</p>
      <div class="share-options">
        <button class="share-btn" onclick="wastelandSocial.copyToClipboard()">
          <i class="fas fa-link"></i>
          <div>
            <strong>Copy Link</strong>
            <div style="font-size: 0.8rem; color: #cd5c5c;">Share direct link to this post</div>
          </div>
        </button>
        <button class="share-btn" onclick="wastelandSocial.shareToDiscord()">
          <i class="fab fa-discord"></i>
          <div>
            <strong>Share to Discord</strong>
            <div style="font-size: 0.8rem; color: #cd5c5c;">Copy message for Discord server</div>
          </div>
        </button>
        <button class="share-btn" onclick="wastelandSocial.shareToTwitter()">
          <i class="fab fa-twitter"></i>
          <div>
            <strong>Share to Twitter/X</strong>
            <div style="font-size: 0.8rem; color: #cd5c5c;">Post to your Twitter feed</div>
          </div>
        </button>
        <button class="share-btn" onclick="wastelandSocial.shareToFacebook()">
          <i class="fab fa-facebook"></i>
          <div>
            <strong>Share to Facebook</strong>
            <div style="font-size: 0.8rem; color: #cd5c5c;">Post to your Facebook timeline</div>
          </div>
        </button>
        <button class="share-btn" onclick="wastelandSocial.shareToReddit()">
          <i class="fab fa-reddit"></i>
          <div>
            <strong>Share to Reddit</strong>
            <div style="font-size: 0.8rem; color: #cd5c5c;">Post to r/dayz or gaming subreddits</div>
          </div>
        </button>
        <button class="share-btn" onclick="wastelandSocial.shareToLinkedIn()">
          <i class="fab fa-linkedin"></i>
          <div>
            <strong>Share to LinkedIn</strong>
            <div style="font-size: 0.8rem; color: #cd5c5c;">Professional gaming content</div>
          </div>
        </button>
        <button class="share-btn" onclick="wastelandSocial.shareToWhatsApp()">
          <i class="fab fa-whatsapp"></i>
          <div>
            <strong>Share to WhatsApp</strong>
            <div style="font-size: 0.8rem; color: #cd5c5c;">Send to friends and groups</div>
          </div>
        </button>
      </div>
      <button class="post-btn" onclick="wastelandSocial.closeShareModal()" style="margin-top: 1rem; width: 100%;">
        Close
      </button>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification"></div>

  <!-- Main Container -->
  <div class="main-container">
    <!-- Left Sidebar -->
    <div class="sidebar">
      <!-- User Profile -->
      <div class="user-profile">
        <div class="profile-avatar" id="userAvatar">
          <i class="fas fa-user"></i>
        </div>
        <h4 id="userName">Survivor</h4>
        <p id="userHandle">@survivor</p>
        <div class="profile-stats">
          <div class="stat">
            <div class="stat-number" id="postCount">0</div>
            <div class="stat-label">Posts</div>
          </div>
          <div class="stat">
            <div class="stat-number" id="followerCount">0</div>
            <div class="stat-label">Followers</div>
          </div>
          <div class="stat">
            <div class="stat-number" id="followingCount">0</div>
            <div class="stat-label">Following</div>
          </div>
        </div>
      </div>

      <!-- Quick Stats -->
      <div>
        <h3><i class="fas fa-chart-line"></i> Server Stats</h3>
        <div class="trending-item">
          <div class="trending-tag">Players Online</div>
          <div class="trending-count">--/60</div>
        </div>
        <div class="trending-item">
          <div class="trending-tag">Total Survivors</div>
          <div class="trending-count">--</div>
        </div>
        <div class="trending-item">
          <div class="trending-tag">Active Clans</div>
          <div class="trending-count">--</div>
        </div>
      </div>
    </div>

    <!-- Main Feed -->
    <div class="feed-container">
      <!-- Post Composer -->
      <div class="post-composer fade-in">
        <div class="composer-header">
          <div class="composer-avatar">
            <i class="fas fa-user"></i>
          </div>
          <div class="composer-input">
            <input type="text" id="handleInput" placeholder="Your handle (optional)" style="width: 100%; background: rgba(10,0,0,0.6); border: 1px solid rgba(220,20,20,.4); border-radius: 5px; padding: 0.5rem; color: #e0e0e0; margin-bottom: 0.5rem;">
          </div>
        </div>
        <textarea id="postText" class="composer-textarea" placeholder="Share your survival story, screenshots, or intel..."></textarea>
        <div class="media-preview" id="mediaPreview"></div>
        <div class="composer-actions">
          <div class="media-upload">
            <label class="upload-btn" for="imageUpload">
              <i class="fas fa-image"></i> Photo
            </label>
            <label class="upload-btn" for="videoUpload">
              <i class="fas fa-video"></i> Video
            </label>
            <input type="file" id="imageUpload" class="file-input" accept="image/*">
            <input type="file" id="videoUpload" class="file-input" accept="video/*">
          </div>
          <button class="post-btn" id="postBtn">
            <i class="fas fa-paper-plane"></i> Share Intel
          </button>
        </div>
      </div>

      <!-- Feed -->
      <div id="feed"></div>
    </div>

    <!-- Right Sidebar -->
    <div class="sidebar">
      <!-- Trending -->
      <div>
        <h3><i class="fas fa-fire"></i> Trending</h3>
        <div class="trending-item">
          <div class="trending-tag">No trending topics yet</div>
          <div class="trending-count">Start posting with hashtags!</div>
        </div>
      </div>

      <div style="margin-top: 2rem;">
        <h3><i class="fas fa-users"></i> Who to Follow</h3>
        <div class="suggestion-item">
          <div class="suggestion-info" style="text-align: center; color: #cd5c5c;">
            <div class="suggestion-name">No suggestions yet</div>
            <div class="suggestion-handle">Start following other survivors!</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Enhanced Social Media JavaScript with Working Comments & Sharing
    class WastelandSocial {
      constructor() {
        this.posts = JSON.parse(localStorage.getItem('trd_posts') || '[]');
        this.currentUser = JSON.parse(localStorage.getItem('trd_user') || '{}');
        this.following = JSON.parse(localStorage.getItem('trd_following') || '[]');
        this.currentSharePost = null;
        this.initializeUser();
        this.setupEventListeners();
        this.loadFeed();
        this.updateStats();
      }

      initializeUser() {
        if (!this.currentUser.handle) {
          this.currentUser = {
            handle: 'Survivor_' + Math.floor(Math.random() * 9999),
            name: 'Survivor',
            avatar: '🎯',
            joinDate: new Date().toISOString()
          };
          localStorage.setItem('trd_user', JSON.stringify(this.currentUser));
        }
        
        document.getElementById('userName').textContent = this.currentUser.name;
        document.getElementById('userHandle').textContent = '@' + this.currentUser.handle;
        document.getElementById('handleInput').value = this.currentUser.handle;
      }

      setupEventListeners() {
        // Post button
        document.getElementById('postBtn').addEventListener('click', () => this.createPost());
        
        // Media uploads
        document.getElementById('imageUpload').addEventListener('change', (e) => this.handleMediaUpload(e, 'image'));
        document.getElementById('videoUpload').addEventListener('change', (e) => this.handleMediaUpload(e, 'video'));
        
        // Feed interactions
        document.getElementById('feed').addEventListener('click', (e) => this.handleFeedInteraction(e));
        
        // Handle input change
        document.getElementById('handleInput').addEventListener('change', (e) => {
          this.currentUser.handle = e.target.value || 'Survivor';
          this.currentUser.name = e.target.value || 'Survivor';
          localStorage.setItem('trd_user', JSON.stringify(this.currentUser));
          document.getElementById('userHandle').textContent = '@' + this.currentUser.handle;
          document.getElementById('userName').textContent = this.currentUser.name;
        });

        // Share modal close on outside click
        document.getElementById('shareModal').addEventListener('click', (e) => {
          if (e.target.id === 'shareModal') {
            this.closeShareModal();
          }
        });
      }

      handleMediaUpload(event, type) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          const preview = document.getElementById('mediaPreview');
          const container = document.createElement('div');
          container.className = 'media-preview-container';
          
          if (type === 'image') {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.className = 'preview-image';
            container.appendChild(img);
          } else if (type === 'video') {
            const video = document.createElement('video');
            video.src = e.target.result;
            video.className = 'preview-image';
            video.controls = true;
            container.appendChild(video);
          }
          
          const removeBtn = document.createElement('button');
          removeBtn.className = 'remove-media';
          removeBtn.innerHTML = '×';
          removeBtn.onclick = () => {
            preview.innerHTML = '';
            event.target.value = '';
          };
          container.appendChild(removeBtn);
          
          preview.innerHTML = '';
          preview.appendChild(container);
        };
        reader.readAsDataURL(file);
      }

      createPost() {
        const content = document.getElementById('postText').value.trim();
        if (!content) {
          this.showNotification('Please write something to share!');
          return;
        }

        const mediaPreview = document.getElementById('mediaPreview');
        let media = null;
        
        if (mediaPreview.children.length > 0) {
          const mediaElement = mediaPreview.querySelector('img, video');
          if (mediaElement) {
            media = {
              type: mediaElement.tagName.toLowerCase(),
              src: mediaElement.src
            };
          }
        }

        const post = {
          id: Date.now(),
          author: this.currentUser.handle,
          authorName: this.currentUser.name,
          content: content,
          media: media,
          timestamp: new Date().toISOString(),
          likes: 0,
          likedBy: [],
          comments: [], // Initialize comments array
          shares: 0
        };

        this.posts.unshift(post);
        localStorage.setItem('trd_posts', JSON.stringify(this.posts));
        
        // Clear composer
        document.getElementById('postText').value = '';
        mediaPreview.innerHTML = '';
        document.getElementById('imageUpload').value = '';
        document.getElementById('videoUpload').value = '';
        
        this.loadFeed();
        this.updateStats();
        this.showNotification('📡 Post shared successfully!');

        // Analytics
        if (typeof gtag !== 'undefined') {
          gtag('event', 'post_created', { 'event_category': 'Social' });
        }
      }

      loadFeed() {
        const feed = document.getElementById('feed');
        feed.innerHTML = '';

        if (this.posts.length === 0) {
          feed.innerHTML = '<div style="text-align: center; padding: 3rem; color: #cd5c5c;"><i class="fas fa-radio" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i><h3>Radio Silence...</h3><p>Be the first survivor to report in from the wasteland!</p></div>';
          return;
        }

        this.posts.forEach(post => {
          const isFollowing = this.following.includes(post.author);
          const postElement = this.createPostElement(post, isFollowing);
          feed.appendChild(postElement);
        });
      }

      createPostElement(post, isFollowing) {
        const div = document.createElement('div');
        div.className = 'post fade-in';
        div.id = `post-${post.id}`;
        
        const timeAgo = this.timeAgo(new Date(post.timestamp));
        const isLiked = post.likedBy.includes(this.currentUser.handle);
        
        div.innerHTML = `
          <div class="post-header">
            <div class="post-user">
              <div class="post-avatar">${post.authorName.charAt(0)}</div>
              <div class="post-info">
                <h4>${post.authorName}</h4>
                <span class="post-time">@${post.author} • ${timeAgo}</span>
              </div>
            </div>
            ${post.author !== this.currentUser.handle ? `
              <button class="follow-btn ${isFollowing ? 'following' : ''}" data-user="${post.author}">
                ${isFollowing ? 'Following' : 'Follow'}
              </button>
            ` : ''}
          </div>
          <div class="post-content">${this.formatContent(post.content)}</div>
          ${post.media ? `
            <div class="post-media">
              ${post.media.type === 'img' 
                ? `<img src="${post.media.src}" class="post-image" alt="Post media">` 
                : `<video src="${post.media.src}" class="post-video" controls></video>`
              }
            </div>
          ` : ''}
          <div class="post-actions">
            <button class="action-btn ${isLiked ? 'active' : ''}" data-action="like" data-post="${post.id}">
              <i class="fas fa-heart"></i> ${post.likes}
            </button>
            <button class="action-btn" data-action="comment" data-post="${post.id}">
              <i class="fas fa-comment"></i> <span id="comment-count-${post.id}">${post.comments.length}</span>
            </button>
            <button class="action-btn" data-action="share" data-post="${post.id}">
              <i class="fas fa-share"></i> ${post.shares}
            </button>
            ${post.author === this.currentUser.handle ? `
              <button class="action-btn" data-action="delete" data-post="${post.id}">
                <i class="fas fa-trash"></i> Delete
              </button>
            ` : ''}
          </div>
          
          <!-- Comments Section -->
          <div class="comments-section" id="comments-${post.id}">
            <div class="comment-form">
              <input type="text" class="comment-input" placeholder="Your handle" style="width: 120px;" id="comment-handle-${post.id}" value="${this.currentUser.handle}">
              <input type="text" class="comment-input" placeholder="Write a comment..." id="comment-text-${post.id}">
              <button class="comment-btn" onclick="wastelandSocial.addComment(${post.id})">
                <i class="fas fa-comment"></i>
              </button>
            </div>
            <div id="comments-list-${post.id}">
              ${this.renderComments(post.comments)}
            </div>
          </div>
        `;
        
        return div;
      }

      renderComments(comments) {
        if (!comments || comments.length === 0) {
          return '<div style="color: #cd5c5c; font-style: italic; text-align: center; padding: 1rem;">No comments yet. Be the first to comment!</div>';
        }

        return comments.map(comment => `
          <div class="comment">
            <div class="comment-header">
              <span class="comment-author">${comment.author}</span>
              <span class="comment-time">${this.timeAgo(new Date(comment.timestamp))}</span>
            </div>
            <div class="comment-text">${this.formatContent(comment.text)}</div>
          </div>
        `).join('');
      }

      addComment(postId) {
        const handleInput = document.getElementById(`comment-handle-${postId}`);
        const textInput = document.getElementById(`comment-text-${postId}`);
        
        const handle = (handleInput.value || '').trim() || 'Survivor';
        const text = (textInput.value || '').trim();
        
        if (!text) {
          this.showNotification('Please write a comment!');
          return;
        }

        const post = this.posts.find(p => p.id === postId);
        if (!post) return;

        const comment = {
          id: Date.now(),
          author: handle,
          text: text,
          timestamp: new Date().toISOString()
        };

        post.comments.push(comment);
        localStorage.setItem('trd_posts', JSON.stringify(this.posts));
        
        // Update the comments display
        const commentsList = document.getElementById(`comments-list-${postId}`);
        if (commentsList) {
          commentsList.innerHTML = this.renderComments(post.comments);
        }
        
        // Update comment count
        const countElement = document.getElementById(`comment-count-${postId}`);
        if (countElement) {
          countElement.textContent = post.comments.length;
        }
        
        // Clear input
        textInput.value = '';
        this.showNotification('💬 Comment added!');
      }

      handleFeedInteraction(event) {
        const button = event.target.closest('button');
        if (!button) return;

        const action = button.dataset.action;
        const postId = parseInt(button.dataset.post);
        const user = button.dataset.user;

        switch (action) {
          case 'like':
            this.toggleLike(postId);
            break;
          case 'comment':
            this.toggleComments(postId);
            break;
          case 'share':
            this.openShareModal(postId);
            break;
          case 'delete':
            this.deletePost(postId);
            break;
        }

        if (user && button.classList.contains('follow-btn')) {
          this.toggleFollow(user, button);
        }
      }

      toggleLike(postId) {
        const post = this.posts.find(p => p.id === postId);
        if (!post) return;

        const userIndex = post.likedBy.indexOf(this.currentUser.handle);
        if (userIndex === -1) {
          post.likedBy.push(this.currentUser.handle);
          post.likes++;
          this.showNotification('❤️ Liked!');
        } else {
          post.likedBy.splice(userIndex, 1);
          post.likes--;
        }

        localStorage.setItem('trd_posts', JSON.stringify(this.posts));
        this.loadFeed();
      }

      toggleComments(postId) {
        const commentsSection = document.getElementById(`comments-${postId}`);
        if (commentsSection) {
          if (commentsSection.classList.contains('show')) {
            commentsSection.classList.remove('show');
          } else {
            commentsSection.classList.add('show');
          }
        }
      }

      toggleFollow(userHandle, button) {
        const index = this.following.indexOf(userHandle);
        if (index === -1) {
          this.following.push(userHandle);
          button.textContent = 'Following';
          button.classList.add('following');
          this.showNotification(`👥 Now following ${userHandle}!`);
        } else {
          this.following.splice(index, 1);
          button.textContent = 'Follow';
          button.classList.remove('following');
          this.showNotification(`👥 Unfollowed ${userHandle}`);
        }
        localStorage.setItem('trd_following', JSON.stringify(this.following));
        this.updateStats();
      }

      // === SHARING FUNCTIONALITY ===
      openShareModal(postId) {
        this.currentSharePost = postId;
        document.getElementById('shareModal').classList.add('show');
      }

      closeShareModal() {
        document.getElementById('shareModal').classList.remove('show');
        this.currentSharePost = null;
      }

      copyToClipboard() {
        const post = this.posts.find(p => p.id === this.currentSharePost);
        if (!post) return;
        
        const url = `${window.location.origin}${window.location.pathname}#post-${this.currentSharePost}`;
        
        try {
          navigator.clipboard.writeText(url).then(() => {
            this.showNotification('🔗 Link copied to clipboard!');
            this.closeShareModal();
          });
        } catch (error) {
          // Fallback for older browsers
          const textArea = document.createElement('textarea');
          textArea.value = url;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          this.showNotification('🔗 Link copied to clipboard!');
          this.closeShareModal();
        }
      }

      shareToDiscord() {
        const post = this.posts.find(p => p.id === this.currentSharePost);
        if (!post) return;
        
        const url = `${window.location.origin}${window.location.pathname}#post-${this.currentSharePost}`;
        const message = `Check out this survival story from **${post.authorName}** on TwoRoadsDayZ:\n\n"${post.content.substring(0, 100)}${post.content.length > 100 ? '...' : ''}"\n\n${url}`;
        
        try {
          navigator.clipboard.writeText(message).then(() => {
            this.showNotification('📋 Discord message copied! Paste it in your server.');
            this.closeShareModal();
          });
        } catch (error) {
          this.showNotification('Failed to copy. Share manually: ' + url);
          this.closeShareModal();
        }
      }

      shareToTwitter() {
        const post = this.posts.find(p => p.id === this.currentSharePost);
        if (!post) return;
        
        const url = `${window.location.origin}${window.location.pathname}#post-${this.currentSharePost}`;
        const text = `Check out this survival story from ${post.authorName} on TwoRoadsDayZ! 🧟‍♂️`;
        const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}&hashtags=DayZ,TwoRoadsDayZ,Survival`;
        
        window.open(twitterUrl, '_blank', 'width=600,height=400');
        this.closeShareModal();
        this.showNotification('🐦 Shared to Twitter/X!');
      }

      shareToFacebook() {
        const post = this.posts.find(p => p.id === this.currentSharePost);
        if (!post) return;
        
        const url = `${window.location.origin}${window.location.pathname}#post-${this.currentSharePost}`;
        const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(`Check out this survival story from ${post.authorName} on TwoRoadsDayZ!`)}`;
        
        window.open(facebookUrl, '_blank', 'width=600,height=400');
        this.closeShareModal();
        this.showNotification('📘 Shared to Facebook!');
      }

      shareToReddit() {
        const post = this.posts.find(p => p.id === this.currentSharePost);
        if (!post) return;
        
        const url = `${window.location.origin}${window.location.pathname}#post-${this.currentSharePost}`;
        const title = `Survival story from ${post.authorName} - TwoRoadsDayZ`;
        const redditUrl = `https://www.reddit.com/submit?url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}`;
        
        window.open(redditUrl, '_blank', 'width=600,height=400');
        this.closeShareModal();
        this.showNotification('🔴 Shared to Reddit!');
      }

      shareToLinkedIn() {
        const post = this.posts.find(p => p.id === this.currentSharePost);
        if (!post) return;
        
        const url = `${window.location.origin}${window.location.pathname}#post-${this.currentSharePost}`;
        const title = `Gaming Community Content - TwoRoadsDayZ`;
        const summary = `Check out this survival story from ${post.authorName} on our DayZ gaming community!`;
        const linkedinUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}&summary=${encodeURIComponent(summary)}`;
        
        window.open(linkedinUrl, '_blank', 'width=600,height=400');
        this.closeShareModal();
        this.showNotification('💼 Shared to LinkedIn!');
      }

      shareToWhatsApp() {
        const post = this.posts.find(p => p.id === this.currentSharePost);
        if (!post) return;
        
        const url = `${window.location.origin}${window.location.pathname}#post-${this.currentSharePost}`;
        const text = `🎮 Check out this survival story from ${post.authorName} on TwoRoadsDayZ!\n\n"${post.content.substring(0, 100)}${post.content.length > 100 ? '...' : ''}"\n\n${url}`;
        const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
        
        window.open(whatsappUrl, '_blank');
        this.closeShareModal();
        this.showNotification('💬 Shared to WhatsApp!');
      }

      deletePost(postId) {
        if (confirm('Delete this post? This action cannot be undone.')) {
          this.posts = this.posts.filter(p => p.id !== postId);
          localStorage.setItem('trd_posts', JSON.stringify(this.posts));
          this.loadFeed();
          this.updateStats();
          this.showNotification('🗑️ Post deleted');
        }
      }

      updateStats() {
        const userPosts = this.posts.filter(p => p.author === this.currentUser.handle);
        document.getElementById('postCount').textContent = userPosts.length;
        document.getElementById('followingCount').textContent = this.following.length;
        document.getElementById('followerCount').textContent = '0';
      }

      formatContent(content) {
        return content
          .replace(/#(\w+)/g, '<span style="color: #dc1414; font-weight: bold;">#$1</span>')
          .replace(/@(\w+)/g, '<span style="color: #ff6b6b; font-weight: bold;">@$1</span>');
      }

      timeAgo(date) {
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMins / 60);
        const diffDays = Math.floor(diffHours / 24);

        if (diffMins < 1) return 'now';
        if (diffMins < 60) return `${diffMins}m`;
        if (diffHours < 24) return `${diffHours}h`;
        return `${diffDays}d`;
      }

      showNotification(message) {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.classList.add('show');
        setTimeout(() => {
          notification.classList.remove('show');
        }, 3000);
      }
    }

    // Initialize the social platform and make it globally accessible
    let wastelandSocial;
    document.addEventListener('DOMContentLoaded', () => {
      wastelandSocial = new WastelandSocial();
    });
  </script>
</body>
</html>
